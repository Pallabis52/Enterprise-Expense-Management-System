spring.application.name=Expense Management

# ── Startup & Performance Optimizations ───────────────────────────────────────
spring.main.banner-mode=off
spring.jpa.open-in-view=false

# ── Database Pool Optimization (Strictly limit threads) ─────────────────────
# Each connection in the pool uses memory and a thread. 
# Reducing this to 5 is plenty for dev and much safer for 6GB systems.
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.max-lifetime=1800000

# Database Configuration
# Database Configuration
spring.datasource.url=jdbc:postgresql://localhost:5432/expense_management
spring.datasource.username=postgres
spring.datasource.password=Aditya
spring.datasource.driver-class-name=org.postgresql.Driver
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true


# File upload configuration
app.file.upload-dir=uploads
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=20MB

server.port=8081

# ── Ollama AI (Standardized on Phi-3) ─────────────────────────────────────────
ollama.base-url=http://127.0.0.1:11434
# phi3:latest is the standardized model for all tasks
ollama.model=phi3:latest
# Lightweight model for simple tasks (categorize, policy check)
ollama.light-model=phi3:latest
# phi3 is generally faster but keeping 90s timeout for safety on CPU
ollama.timeout-seconds=90
# TCP connect timeout in seconds (fast-fail when Ollama is completely down)
ollama.connect-timeout-seconds=8
# Retry config: 2 retries with 3s back-off for transient Netty failures
ollama.retry.max-attempts=2
ollama.retry.backoff-seconds=3
# Send a warm-up prompt at startup so the model is already loaded
# Disable warm-up to save startup RAM on 6GB system
ollama.warmup.enabled=false

# ── AI Response Cache (Caffeine) ─────────────────────────────────────────────
# 5-minute TTL, max 200 cached entries — no Redis needed
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=200,expireAfterWrite=5m

# ── DevTools — allow restart for AI package to avoid classloader mismatch ───
ollama.async.enabled=true

# ── Security & Diagnostic Logging ─────────────────────────────────────────────
logging.level.com.expensemanagement.security=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.security.web.access=DEBUG
# AUTH-DIAGNOSTIC is active in the JwtAuthenticationFilter code
